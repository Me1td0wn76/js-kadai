# 境界都市トウキョウ ～分岐の刻～

JavaScriptで作られた2D/3DハイブリッドRPGゲームです。PixiJS（2D）とThree.js（3D）を組み合わせて、豊かなゲーム体験を提供します。

## 🎮 ゲーム概要

- **ジャンル**: RPG（ロールプレイングゲーム）
- **プラットフォーム**: ブラウザ（WebGL対応）
- **技術**: JavaScript, PixiJS v8, Three.js, GSAP, Vite

## ✨ 特徴

- **ハイブリッド描画システム**: 2D（PixiJS）と3D（Three.js）の組み合わせ
- **画像ベースキャラクター**: 実際の画像ファイルを使用したリアルなスプライト
- **ストーリーモード**: 没入感のあるストーリー展開
- **ダンジョン探索**: 3D一人称視点でのダンジョン探索
- **戦闘システム**: ターン制バトルシステム
- **セーブ/ロード機能**: ローカルストレージを使用したゲームデータ保存

## 🗺️ ゲームシステム

### シーン構成
1. **メニューシーン**: ゲーム開始・継続・設定
2. **ワールドマップ**: 2Dトップビューでの移動・探索
3. **ダンジョンシーン**: 3D一人称視点での迷宮探索
4. **戦闘シーン**: ターン制バトル画面

### 主要機能
- **移動システム**: 矢印キー/WASDでの移動
- **エンカウントシステム**: ランダム敵出現
- **アイテム収集**: 宝箱からのアイテム取得
- **レベルアップ**: 経験値による成長システム

## 🛠️ 技術仕様

### フロントエンド
- **メインエンジン**: PixiJS v8.0+
- **3Dエンジン**: Three.js
- **アニメーション**: GSAP (GreenSock)
- **ビルドツール**: Vite
- **言語**: JavaScript (ES6+)

### アセット管理
- **画像読み込み**: カスタムImageLoaderクラス
- **スプライトシート**: アニメーションフレーム対応
- **フォールバック**: 画像未読み込み時のプロシージャル描画

### アーキテクチャ
- **シーン管理**: BaseSceneクラスによる統一インターフェース
- **状態管理**: ローカルストレージでのゲームデータ永続化
- **入力処理**: キーボード/マウス統合処理

## 🚀 セットアップ

### 必要環境
- Node.js 16.0+
- npm または yarn
- モダンブラウザ（WebGL対応）

### インストール
```bash
# リポジトリのクローン
git clone [リポジトリURL]
cd js-kadai

# 依存関係のインストール
npm install

# 開発サーバー起動
npm run dev
```

### ビルド
```bash
# 本番用ビルド
npm run build

# プレビュー
npm run preview
```

## 🎯 操作方法

### 基本操作
- **移動**: 矢印キー または WASD
- **決定**: Enter または Space
- **戻る**: Escape
- **エリア侵入**: Enterキー（エリアアイコン上で）

### ワールドマップ
- プレイヤーキャラクターを移動
- ダンジョンアイコンに近づいてEnterで入場
- ランダムエンカウントによる戦闘発生

### ダンジョン探索
- マウス: 視点回転
- WASD: 移動
- Escape: ダンジョンから退出

### 戦闘
- 矢印キー: アクション選択
- Enter: 決定
- Escape: 逃走

## 📁 プロジェクト構造

```
js-kadai/
├── public/
│   └── vite.svg
├── src/
│   ├── main.js                 # エントリーポイント
│   ├── assets/
│   │   └── ImageLoader.js      # 画像読み込み管理
│   ├── data/                   # ゲームデータ
│   ├── entities/
│   │   ├── PlayerIcon.js       # プレイヤースプライト
│   │   └── EnemyIcon.js        # 敵スプライト
│   ├── images/                 # ゲーム画像アセット
│   │   ├── haikei.png          # 背景画像
│   │   ├── human1.png          # プレイヤー画像
│   │   ├── dr_mirela_cientist.png
│   │   ├── sprite.png
│   │   └── trool_idlewalk_atack_die.png
│   └── scenes/
│       ├── SceneManager.js     # シーン管理
│       ├── MenuScene.js        # メニューシーン
│       ├── WorldMapScene.js    # ワールドマップ
│       ├── DungeonScene.js     # 3Dダンジョン
│       └── BattleScene.js      # 戦闘シーン
├── package.json
├── vite.config.js
└── README.md
```

## 🎨 アセット情報

### 使用画像
- `haikei.png`: ワールドマップ背景
- `human1.png`: プレイヤーキャラクター
- `dr_mirela_cientist.png`: NPCキャラクター
- `trool_idlewalk_atack_die.png`: 敵キャラクター（トロール）
- `sprite.png`: 汎用スプライト

### サポートフォーマット
- PNG, JPG, WebP
- スプライトシート対応
- 自動フォールバック生成

## 🔧 開発情報

### デバッグ機能
- ブラウザコンソールで `clearOverlay()` - シーン遷移オーバーレイ削除
- F12開発者ツールでのリアルタイムデバッグ
- Viteホットリロード対応

### カスタマイズ
- `src/data/` - ゲームデータの編集
- `src/images/` - 新しい画像アセットの追加
- `src/scenes/` - 新しいシーンの追加

## ⚠️ 既知の問題・未実装機能

### 🚧 未実装機能
- **街シーン**: ワールドマップの街エリアは未実装
- **オプション画面**: メニューのオプション設定は未実装
- **アイテム獲得処理**: ダンジョンの宝箱システム（表示のみ）
- **詳細なゲームバランス調整**: 戦闘パラメータの最適化
- **セーブスロット機能**: 単一セーブデータのみ対応
- **サウンド/BGMシステム**: 音響効果未実装
- **高度なエフェクト**: パーティクルシステムの拡張
- **キーコンフィグ**: 操作キーのカスタマイズ

### � 技術的な制限事項
- **PixiJS v8 API移行**: 一部の古いAPIが残存（段階的修正中）
- **メモリ管理**: テクスチャのガベージコレクション最適化未完了
- **マルチプラットフォーム対応**: モバイル端末での操作性未調整
- **パフォーマンス最適化**: 大量オブジェクト処理時の最適化
- **エラーハンドリング**: 包括的なエラー回復機能の不足

### �🐛 既知のバグ・問題

**シーン遷移時のオーバーレイ残存**
```javascript
// ブラウザコンソールで実行（緊急時）
clearOverlay()
```

**画像アセット読み込み失敗**
- ネットワークエラー時、フォールバック描画が表示されます
- リロードで再読み込みを試してください

**PixiJS v8互換性警告**
- 一部の古いAPI使用による警告が表示される場合があります
- ゲームの動作には影響ありません
- ⚠️ **2025年7月修正**: `polygon`→`poly`、`beginFill/endFill`→`fill`、`drawRoundedRect`→`roundRect`に対応済み

**3Dダンジョン表示問題**
- WebGL未対応環境では正常に表示されません
- ハードウェアアクセラレーションを有効にしてください

**EnemyIcon描画エラー**
- ⚠️ **修正済み**: PixiJS v8のAPIエラー（`enemyGraphics.polygon is not a function`）を修正
- フォールバック描画が正常に動作するようになりました

### 💻 開発者向けデバッグ情報

**コンソール出力の種類**
- 初期化ログ: ゲーム/シーンの起動状況
- エラーログ: 重要な問題の詳細情報
- デバッグログ: 開発用の詳細情報

**よく出現するエラーメッセージ**
- `プレイヤーが作成されていません`: プレイヤー初期化の失敗
- `ゲームコンテナが見つかりません`: DOM要素の取得失敗
- `画像読み込みエラー`: アセットファイルのロード失敗
- `シーン '${sceneName}' が見つかりません`: 無効なシーン名指定
- ⚠️ **修正済み**: `enemyGraphics.polygon is not a function`: PixiJS v8 API変更によるエラー（修正済み）
- ⚠️ **修正済み**: `beginFill/endFill` 関連エラー: 新しいfill APIに対応済み
- ⚠️ **未修正**: `beginFill is not a function`: Player.js、Game.js、TilemapLoader.jsで発生可能
- ⚠️ **未修正**: `drawRect is not a function`: 旧Graphics API使用箇所で発生
- `Cannot read property 'x' of null`: プレイヤーオブジェクト未初期化エラー
- `LocalStorage quota exceeded`: セーブデータ保存容量超過
- `WebGL context lost`: GPU関連エラー（3Dダンジョン）


### よくある問題

**画面が真っ暗になる**
```javascript
// ブラウザコンソールで実行
clearOverlay()
```

**PixiJS警告が表示される**
- PixiJS v8の新しいAPI仕様により、一部警告が表示される場合があります
- ゲームの動作には影響ありません

**3Dダンジョンが表示されない**
- WebGL対応ブラウザで実行してください
- ハードウェアアクセラレーションを有効にしてください

**キャラクターが表示されない**
- ImageLoaderの読み込み完了を待つか、ページをリロードしてください
- フォールバック描画（四角形）が表示される場合があります

**レガシーAPI関連エラー**
- Player.js、Game.js、TilemapLoader.jsで旧PixiJS APIエラーが発生する場合があります
- 一時的にページをリロードして問題が解決するかお試しください

**パフォーマンス低下**
- 長時間プレイ後にゲームが重くなる場合は、ブラウザタブをリフレッシュしてください
- メモリ使用量が多い場合は、他のタブを閉じることを推奨します

**セーブデータ問題**
- セーブデータが読み込めない場合：ブラウザのローカルストレージをクリア
- データ破損の場合：開発者ツール（F12）→ Application → Local Storage → クリア

## 📝 更新履歴

### v1.0.0 (2025年7月)
- PixiJS v8対応完了
- 画像ベーススプライトシステム実装
- 建物内部照明改善
- ImageLoader統合
- EnemyIcon新アーキテクチャ

### 主要修正
- Graphics API更新（PixiJS v8準拠）
- シーン遷移オーバーレイ問題解決
- Three.jsダンジョン明度改善
- 統合された画像アセット管理
- **EnemyIcon描画エラー修正** (`polygon`→`poly`、`beginFill/endFill`→`fill`対応)
- **UIエレメント描画API更新** (BattleScene、MenuScene_simple)

### 今後の修正予定
- **レガシーAPI完全対応**: Player.js、Game.js、TilemapLoader.jsのPixiJS v8更新
- **メモリ最適化**: テクスチャ管理とガベージコレクション改善
- **エラーハンドリング強化**: 包括的な例外処理とフォールバック機能
- **パフォーマンス改善**: アニメーション処理とレンダリング最適化
- **コードクリーンアップ**: 未使用ファイル削除と重複コード統合

## 🤝 貢献

プルリクエストや Issue の報告を歓迎します。

## 📄 ライセンス

このプロジェクトは個人開発用です。

## 🔗 関連技術

- [PixiJS](https://pixijs.com/) - 2Dレンダリングエンジン
- [Three.js](https://threejs.org/) - 3Dレンダリングエンジン
- [GSAP](https://greensock.com/gsap/) - アニメーションライブラリ
- [Vite](https://vitejs.dev/) - 高速ビルドツール

# 最後に  
これはJSの課題として作成してみたゲームです。  
よくよく考えるとjavaScriptでRPGゲームを作るのって意味わかんないね。    
以上YAMAでした。
